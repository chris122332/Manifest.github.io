<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Portal de Busca Steam</title>
  <link rel="stylesheet" href="style.css"> 
</head>
<body>

  <video autoplay muted loop id="background-video">
    <source src="Video.mp4" type="video/mp4">
    Seu navegador n√£o suporta a tag de v√≠deo.
  </video>
  
  <div id="user-profile-widget">
      <span id="widget-username">Visitante</span>
      <img id="widget-profile-pic" src="default-avatar.png" alt="Perfil" class="profile-avatar">
  </div>
  
  <div class="main-layout logged-out"> 
    
    <aside class="sidebar">

      <ul class="sidebar-menu">
        <li><a href="#" class="nav-link active" data-target="home-screen">Home</a></li>
        <li><a href="#" class="nav-link" data-target="support-screen">Suporte</a></li>
        <li id="sidebar-signup-link"><a href="#" class="nav-link" data-target="signup-screen">Sign-Up</a></li> 
        <li><a href="#" class="nav-link" data-target="terms-screen">Pol√≠tica e Termos de Uso</a></li>
        <li><a href="#" class="nav-link" data-target="about-screen">Sobre o Projeto</a></li>
        </ul>
    </aside>

    <div class="content">
        <h1 id="main-title">Portal de Busca Steam</h1>
        
      <div id="home-screen" class="content-screen active home-content">
        
        <div id="home-cards-view" class="active">
            
            <div class="feature-card" data-target-sub="search-sub-screen">
                <div class="card-content-wrapper">
                    <div class="card-icon">üîé</div>
                    <div class="card-title">Buscar Jogo</div>
                    <div class="card-subtitle">Pesquise e baixe por ID Steam.</div>
                </div>
            </div>
            
            <div class="feature-card" data-target-sub="list-sub-screen">
                <div class="card-content-wrapper">
                    <div class="card-icon">üìÑ</div>
                    <div class="card-title">Lista de IDs</div>
                    <div class="card-subtitle">Verifique os jogos dispon√≠veis.</div>
                </div>
            </div>
            
            <div class="feature-card" data-target-sub="download-sub-screen">
                <div class="card-content-wrapper">
                    <div class="card-icon">‚öôÔ∏è</div>
                    <div class="card-title">Programa Auxiliar</div>
                    <div class="card-subtitle">Baixe o programa de suporte.</div>
                </div>
            </div>
            
        </div>
        
        <div id="search-sub-screen" class="sub-screen home-sub">
            <button class="back-button" data-target-sub="home-cards-view" data-screen-type="home">Voltar</button>
            <h2>Pesquisar e Baixar por ID</h2>
            <div class="container">
              <input type="text" id="gameId" placeholder="Digite o ID do jogo Steam (ex: 730)">
              <button id="buscar">Pesquisar e Baixar</button>
              <div id="resultado"></div>
            </div>
        </div>
        
        <div id="list-sub-screen" class="sub-screen home-sub">
            <button class="back-button" data-target-sub="home-cards-view" data-screen-type="home">Voltar</button>
            <h2>Lista de IDs Dispon√≠veis</h2>
            
            <div id="list-cards-view">
                </div>
            
            <div id="id-list-content">
                <p>Carregando lista de IDs...</p>
            </div>
        </div>
        
        <div id="download-sub-screen" class="sub-screen home-sub">
            <button class="back-button" data-target-sub="home-cards-view" data-screen-type="home">Voltar</button>
            <h2>Download do Programa Auxiliar</h2>
            <div id="download-content">
                <p>Para o melhor uso da ferramenta, baixe o nosso programa de suporte. Ele √© essencial para a automa√ß√£o.</p>
                <a id="download-button" href="https://www.mediafire.com/file/o6xotmefboon1j5/Steam+Tools.exe/file" download="Steam Tools" target="_blank">
                    Baixar Programa
                </a>
            </div>
        </div>
        
      </div> 
      
      <div id="support-screen" class="content-screen">
        
        <div id="support-cards-view" class="active">
            
            <div class="feature-card support-card" data-target-sub="faq-sub-screen">
                <div class="card-content-wrapper">
                    <div class="card-icon">‚ùì</div>
                    <div class="card-title">FAQ</div>
                    <div class="card-subtitle">Respostas para perguntas comuns.</div>
                </div>
            </div>
            
            <div class="feature-card support-card" data-target-sub="report-sub-screen">
                <div class="card-content-wrapper">
                    <div class="card-icon">‚ö†Ô∏è</div>
                    <div class="card-title">Reportar / Feedback</div>
                    <div class="card-subtitle">Envie bugs ou sugest√µes.</div>
                </div>
            </div>
            
            <div class="feature-card support-card" data-target-sub="config-sub-screen">
                <div class="card-content-wrapper">
                    <div class="card-icon">üîß</div>
                    <div class="card-title">Configura√ß√µes</div>
                    <div class="card-subtitle">Ajustes de Tema, Fonte e Conta.</div>
                </div>
            </div>
            
        </div>
        
        <div id="faq-sub-screen" class="sub-screen support-sub">
            <button class="back-button" data-target-sub="support-cards-view" data-screen-type="support">Voltar</button>
            <h2>Perguntas Frequentes (FAQ)</h2>
            <div class="faq-content">
                
                <h3>üß† Geral / Institucional</h3>
                <div class="faq-item">
                    <div class="faq-question">O que √© Manifest Sample?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>√â um programa/site que permite baixar arquivos manifest/lua usados no Steam Tools, de forma simples e totalmente segura.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Como funciona o servi√ßo?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>V√° na aba Home, clique no card ‚ÄúBuscar Jogos‚Äù, digite o ID do seu jogo (pegue em steamdb.info), baixe, extraia e arraste os arquivos para o √≠cone do Steam Tools.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Preciso pagar alguma coisa para usar?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>N√£o. Nosso programa √© totalmente gratuito.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Voc√™s t√™m suporte 24h?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>Sim, mas o atendimento humano √© das 8h √†s 21h. Fora desse hor√°rio, voc√™ ser√° atendido por um bot automatizado.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Onde fica a empresa?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>Somos uma plataforma 100% virtual. Nosso foco √© garantir seguran√ßa e praticidade pra voc√™.</p></div>
                </div>
                
                <h3>üë§ Conta e Login</h3>
                <div class="faq-item">
                    <div class="faq-question">Como crio minha conta?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>V√° na aba Sign-up e preencha seus dados. Evite usar senhas de outros aplicativos importantes. Crie uma senha exclusiva para nosso site.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Esqueci minha senha, e agora?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>Pe√ßa um c√≥digo de recupera√ß√£o por e-mail para redefinir.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Posso mudar meu e-mail ou nome de usu√°rio?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>Sim, isso √© totalmente poss√≠vel nas configura√ß√µes da conta.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Como deleto minha conta?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>A gente n√£o quer te perder, mas se for o caso, v√° em Configura√ß√µes ‚Üí Privacidade ‚Üí Conta e selecione Deletar Conta. Um c√≥digo de confirma√ß√£o ser√° necess√°rio.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Recebi um e-mail suspeito, o que fazer?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>Verifique o remetente. Se n√£o for nosso oficial (Manifest Sample v1 OFC), ignore. Provavelmente √© golpe.</p></div>
                </div>
                
                <h3>‚öôÔ∏è Uso da Plataforma / Funcionalidades</h3>
                <div class="faq-item">
                    <div class="faq-question">O site funciona no celular?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>Sim, funciona normalmente.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Tem app dispon√≠vel?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>Ainda n√£o.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Posso usar offline?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>N√£o. O site depende de conex√£o com a internet, caso contr√°rio nem abrir o navegador voc√™ vai conseguir.</p></div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Como reporto um bug ou erro?<span class="arrow">‚ñº</span></div>
                    <div class="faq-answer"><p>Use a aba Suporte / Feedback ou envie seu relato diretamente pela √°rea de Reportes no site.</p></div>
                </div>
                
            </div>
        </div>
        
        <div id="report-sub-screen" class="sub-screen support-sub">
            <button class="back-button" data-target-sub="support-cards-view" data-screen-type="support">Voltar</button>
            <h2>Reportar Erro ou Enviar Feedback</h2>
            <div class="report-content">
                <p>Preencha os campos abaixo com o m√°ximo de detalhes poss√≠vel para nos ajudar a melhorar.</p>
                <input type="text" id="report-subject" placeholder="Assunto (Ex: Bug na busca / Sugest√£o de cor)">
                <textarea id="report-details" placeholder="Detalhes do problema ou sugest√£o..."></textarea>
                <button id="report-button">Enviar Relato</button>
                <div id="report-message"></div>
            </div>
        </div>
        
        <div id="config-sub-screen" class="sub-screen support-sub">
            <button class="back-button" data-target-sub="support-cards-view" data-screen-type="support">Voltar</button>
            <h2>Configura√ß√µes do Portal</h2>
            <div class="config-content">
                
                <h3>üé® Apar√™ncia</h3>
                <div class="config-option">
                    <span>Tema Escuro (Padr√£o) / Claro</span>
                    <label class="switch">
                        <input type="checkbox" id="theme-switch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="config-option">
                    <span>Usar Fonte Cl√°ssica ('Roboto')</span>
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <h3 style="margin-top: 40px;">üë§ Minha Conta</h3>
                
                <div class="config-option" style="flex-direction: column; align-items: flex-start; gap: 10px; border-bottom: 1px solid #333; padding-bottom: 20px;">
                    <span style="font-weight: bold; color: #00ff80; margin-bottom: 10px;">Informa√ß√µes de Perfil:</span>
                    <div style="display: flex; align-items: center; gap: 15px; width: 100%;">
                        <img id="profile-pic-preview" src="default-avatar.png" alt="Avatar" class="profile-avatar" style="width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 3px solid #1e90ff;">
                        
                        <input type="text" id="edit-username" placeholder="Nome de Usu√°rio" style="margin-bottom: 0; max-width: 200px; padding: 10px; font-size: 1rem;">
                        <button id="save-username-btn" style="padding: 8px 15px; font-size: 0.9rem; letter-spacing: 0;">Salvar Nome</button>
                    </div>
                    
                    <input type="text" id="edit-email" placeholder="Email" style="margin-top: 15px; margin-bottom: 0; padding: 10px; font-size: 1rem;">
                    <input type="text" id="edit-password" placeholder="Nova Senha" style="margin-top: 15px; margin-bottom: 0; padding: 10px; font-size: 1rem;">
                    <button id="save-account-btn" style="margin-top: 20px; font-size: 1rem;">Salvar Altera√ß√µes de Login</button>
                    <div id="personalize-message" style="margin-top: 10px;"></div>
                </div>

                <div class="config-option">
                    <span>Exportar Dados Pessoais (JSON)</span>
                    <button id="export-data-btn">Exportar</button>
                </div>

                <div class="config-option">
                    <span>Sair da Conta (Logout)</span>
                    <button id="logout-btn" class="back-button" style="background: #ff4444 !important; color: #fff; box-shadow: 0 5px 10px rgba(255, 68, 68, 0.4) !important; animation: none;">Sair</button>
                </div>
                
                <div class="config-option" style="border-bottom: none;">
                    <span>Deletar Conta Permanentemente</span>
                    <button id="delete-account-btn" class="back-button" style="background: #555 !important; color: #ccc; box-shadow: none !important; animation: none;">Deletar</button>
                </div>

            </div>
        </div>
        
        </div>

      <div id="signup-screen" class="content-screen active">
        
        <div id="signup-cards-view" class="active">
            
            <div class="feature-card" data-target-sub="login-sub-screen">
                <div class="card-content-wrapper">
                    <div class="card-icon" style="color: #4caf50; text-shadow: 0 0 10px #4caf50;">üë§</div>
                    <div class="card-title">Login</div>
                    <div class="card-subtitle">J√° tem conta? Entre aqui.</div>
                </div>
            </div>
            
            <div class="feature-card" data-target-sub="create-account-sub-screen">
                <div class="card-content-wrapper">
                    <div class="card-icon" style="color: #ffa500; text-shadow: 0 0 10px #ffa500;">‚ûï</div>
                    <div class="card-title">Criar Conta</div>
                    <div class="card-subtitle">Novo por aqui? Cadastre-se.</div>
                </div>
            </div>
            
        </div>
        
        <div id="login-sub-screen" class="sub-screen signup-sub">
            <button class="back-button" data-target-sub="signup-cards-view" data-screen-type="signup">Voltar</button>
            <h2>Acessar Minha Conta</h2>
            <div class="container">
              <input type="text" id="login-email" placeholder="Email ou Nome de Usu√°rio">
              <input type="text" id="login-password" placeholder="Senha">
              <button id="login-btn">Entrar</button>
              <div id="login-message"></div>
            </div>
        </div>
        
        <div id="create-account-sub-screen" class="sub-screen signup-sub">
            <button class="back-button" data-target-sub="signup-cards-view" data-screen-type="signup">Voltar</button>
            <h2>Criar Nova Conta</h2>
            <div class="container">
              <p>Suas informa√ß√µes ser√£o salvas localmente para fins de demonstra√ß√£o (simula√ß√£o de JSON).</p>
              <input type="text" id="new-username" placeholder="Nome de Usu√°rio">
              <input type="text" id="new-email" placeholder="Email">
              <input type="text" id="new-password" placeholder="Senha">
              
              <label for="new-profile-pic" class="file-upload-label">
                  Escolher Foto de Perfil (Opcional)
              </label>
              <input type="file" id="new-profile-pic" accept="image/*" style="display: none;">
              
              <button id="create-account-btn">Cadastrar</button>
              <div id="create-account-message"></div>
            </div>
        </div>
        
      </div>
      
      <div id="terms-screen" class="content-screen">
          
          <div class="container" style="max-width: 800px; text-align: left;">
              <p>Bem-vindo ao nosso site! Ao acessar e usar nossos servi√ßos, voc√™ concorda com as regras abaixo. Se n√£o estiver de acordo, por favor, n√£o utilize o site.</p>

              <h3>1. Uso do Site</h3>
              <p>Este site oferece acesso a manifests de jogos da Steam com o objetivo de facilitar downloads leg√≠timos, backups ou estudos relacionados a jogos que o usu√°rio j√° possui.</p>
              <p>Voc√™ concorda em usar o site de forma respons√°vel, sem pr√°ticas ilegais, abusivas ou que prejudiquem terceiros.</p>
              
              <h3>2. Hospedagem de Arquivos</h3>
              <p>Os arquivos disponibilizados s√£o hospedados por n√≥s, de forma organizada e segura.</p>
              <p>Todo o conte√∫do disponibilizado tem car√°ter informativo e de apoio t√©cnico. N√£o oferecemos jogos completos, cracks ou qualquer tipo de conte√∫do pirateado.</p>
              
              <h3>3. Responsabilidade do Usu√°rio</h3>
              <p>O uso dos manifests √© de responsabilidade exclusiva do usu√°rio.</p>
              <p>N√£o nos responsabilizamos por:</p>
              <ul>
                  <li>Uso indevido dos arquivos</li>
                  <li>Poss√≠veis bans ou restri√ß√µes em contas Steam</li>
                  <li>Problemas t√©cnicos no seu computador</li>
              </ul>
              <p>Use por sua conta e risco, dentro das regras da plataforma Steam e das leis aplic√°veis.</p>

              <h3>4. Direitos Autorais</h3>
              <p>Todas as marcas, nomes e conte√∫dos relacionados aos jogos pertencem aos seus respectivos propriet√°rios.</p>
              <p>Este site n√£o tem v√≠nculo oficial com a Valve ou com a Steam. N√£o revendemos, modificamos ou comercializamos nenhum arquivo.</p>
              
              <h3>5. Conta e Seguran√ßa</h3>
              <p>Caso o site ofere√ßa login ou hist√≥rico de uso, voc√™ √© o √∫nico respons√°vel por manter seus dados seguros.</p>
              <p>N√£o compartilhe sua conta e n√£o tente acessar dados de terceiros.</p>
              
              <h3>6. Altera√ß√µes dos Termos</h3>
              <p>Podemos atualizar ou modificar estes termos a qualquer momento.</p>
              <p>A vers√£o mais recente estar√° sempre dispon√≠vel nesta p√°gina. O uso cont√≠nuo do site ap√≥s mudan√ßas significa que voc√™ aceita os novos termos.</p>
              
              <h3>7. Contato</h3>
              <p>Para d√∫vidas, suporte ou solicita√ß√µes, utilize os canais de contato indicados no site.</p>
          </div>
      </div>
      
      <div id="about-screen" class="content-screen">
          
          <div class="container" style="max-width: 600px; text-align: left;">
              <h3>Informa√ß√µes T√©cnicas</h3>
              <div class="config-option">
                  <span>Vers√£o Atual</span>
                  <strong>1.5 fase teste</strong>
              </div>
              <div class="config-option">
                  <span>Propriet√°rio</span>
                  <strong>dc __oliversilva</strong>
              </div>
              <div class="config-option">
                  <span>Linguagem Principal (Front-end)</span>
                  <strong>HTML, CSS e JavaScript</strong>
              </div>
              <div class="config-option">
                  <span>Linguagem de Backend (Simulado)</span>
                  <strong>Node.js</strong>
              </div>
              <p style="margin-top: 20px;">Este projeto √© um portal para a ferramenta Steam Tools, focado em facilidade de uso e seguran√ßa no acesso a manifests de jogos para usu√°rios leg√≠timos.</p>
          </div>
      </div>
      
    </div>
    
  </div>

<script>
// Elementos do DOM
    const homeCardsView = document.getElementById('home-cards-view');
    const supportCardsView = document.getElementById('support-cards-view');
    const signupCardsView = document.getElementById('signup-cards-view');
    const listCardsView = document.getElementById('list-cards-view');
    const subScreens = document.querySelectorAll('.sub-screen');
    const homeSubScreens = document.querySelectorAll('.home-sub');
    const supportSubScreens = document.querySelectorAll('.support-sub');
    const signupSubScreens = document.querySelectorAll('.signup-sub');
    const featureCards = document.querySelectorAll('.feature-card');
    const backButtons = document.querySelectorAll('.back-button');
    const contentDiv = document.querySelector('.content');
    const navLinks = document.querySelectorAll('.nav-link');
    const contentScreens = document.querySelectorAll('.content-screen');
    const body = document.body;

    // Simula√ß√£o de JSON para a Conta (Local Storage)
    // O ACCOUNT_STORAGE_KEY agora guarda apenas o status de login e o username
    const ACCOUNT_STORAGE_KEY = 'manifestSampleAccount';
    const THEME_STORAGE_KEY = 'manifestSampleTheme';
    const DEFAULT_AVATAR = 'default-avatar.png';

    // Elementos do Widget de Perfil e Sidebar
    const widgetUsername = document.getElementById('widget-username');
    const widgetProfilePic = document.getElementById('widget-profile-pic');
    const userProfileWidget = document.getElementById('user-profile-widget');
    const sidebar = document.querySelector('.sidebar');
    const mainLayout = document.querySelector('.main-layout'); 

    // Link da Sidebar para o Sign-Up
    const sidebarSignupLink = document.getElementById('sidebar-signup-link');

    // Elementos do Switch de Tema
    const themeSwitch = document.getElementById('theme-switch');

    // Elemento do T√≠tulo Principal
    const mainTitle = document.getElementById('main-title');

    // Elementos de Edi√ß√£o (Manter, mas o foco da altera√ß√£o de email/senha ser√° removido do local storage)
    const editUsernameInput = document.getElementById('edit-username');
    const editEmailInput = document.getElementById('edit-email');
    const editPasswordInput = document.getElementById('edit-password');
    const saveAccountBtn = document.getElementById('save-account-btn');
    const personalizeMessage = document.getElementById('personalize-message');
    const saveUsernameBtn = document.getElementById('save-username-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const deleteAccountBtn = document.getElementById('delete-account-btn');
    
    // Elementos da Busca de Jogo
    const buscarBtn = document.getElementById('buscar');
    const gameIdInput = document.getElementById('gameId');
    const resultadoDiv = document.getElementById('resultado');


    // ----------------------------------------------------
    // FUN√á√ïES DE CONTA E PERSIST√äNCIA (JSON LOCAL)
    // ----------------------------------------------------
    
    /**
     * @returns {Object|null} Retorna os dados da conta local ou null.
     */
    function getAccount() {
        const account = localStorage.getItem(ACCOUNT_STORAGE_KEY);
        const accountData = account ? JSON.parse(account) : null;
        if (accountData && !accountData.profilePicture) {
            accountData.profilePicture = DEFAULT_AVATAR;
        }
        return accountData;
    }

    /**
     * Salva os dados de sess√£o (apenas username e foto) no localStorage.
     * @param {Object} accountData 
     */
    function saveAccount(accountData) {
        localStorage.setItem(ACCOUNT_STORAGE_KEY, JSON.stringify(accountData));
        updateProfileDisplay();
    }
    
    /**
     * Remove a sess√£o.
     */
    function removeAccount() {
        localStorage.removeItem(ACCOUNT_STORAGE_KEY);
        updateProfileDisplay();
    }
    
    /**
     * Fun√ß√£o centralizada para enviar requisi√ß√µes POST com JSON e tratar a resposta.
     * @param {string} endpoint - A rota (ex: '/signup', '/login').
     * @param {Object} data - O objeto JSON a ser enviado.
     * @param {HTMLElement} messageElement - O elemento para exibir as mensagens de sucesso/erro.
     */
    async function sendPostRequest(endpoint, data, messageElement) {
        messageElement.textContent = 'Aguarde...';
        messageElement.style.color = '#ffaa00'; // Amarelo/Laranja de carregamento

        try {
            const response = await fetch(endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });
            
            // Tratamento especial para a rota de download (/buscar)
            if (endpoint === '/buscar') {
                // Se o status for 200 (OK), o servidor pode estar enviando o arquivo (res.download)
                if (response.ok && response.headers.get('Content-Disposition')) {
                    messageElement.textContent = '‚úÖ Jogo encontrado! O download deve iniciar em breve.';
                    messageElement.style.color = '#00ff80';
                    
                    // Como n√£o podemos iniciar o download via JS com o res.download do Express, 
                    // vamos avisar o usu√°rio e tentar fazer o fetch do blob se for JSON de erro
                    return response; // Retorna a resposta para a rota de busca lidar com ela.
                } 
                
                // Se o status for 200, mas n√£o for um download (ou 4xx/5xx)
                const jsonResponse = await response.json(); 
                
                if (response.ok && jsonResponse.encontrado === false) {
                     messageElement.textContent = `‚ùå ${jsonResponse.msg}`;
                     messageElement.style.color = '#ff4444';
                     return jsonResponse;
                }
                
                // Se n√£o for OK (erro do servidor)
                if (!response.ok) {
                    messageElement.textContent = `‚ùå Erro ${response.status}: ${jsonResponse.msg || 'Falha na requisi√ß√£o.'}`;
                    messageElement.style.color = '#ff4444';
                    return jsonResponse;
                }
            }


            // Tratamento para rotas de Autentica√ß√£o (/signup, /login)
            const jsonResponse = await response.json(); 
            
            if (response.ok) {
                messageElement.textContent = `‚úÖ ${jsonResponse.msg}`;
                messageElement.style.color = '#00ff80';
            } else {
                messageElement.textContent = `‚ùå Erro ${response.status}: ${jsonResponse.msg || 'Falha na requisi√ß√£o.'}`;
                messageElement.style.color = '#ff4444';
            }
            return jsonResponse;

        } catch (error) {
            messageElement.textContent = `‚ùå Erro de Rede: ${error.message}. Verifique a conex√£o do servidor.`;
            messageElement.style.color = '#ff4444';
            console.error('Fetch Error:', error);
            return { success: false, msg: 'Erro de rede ou servidor n√£o responde.' };
        }
    }
    
    // ----------------------------------------------------
    // EVENTOS DOS BOT√ïES DE AUTENTICA√á√ÉO
    // ----------------------------------------------------

    // Fun√ß√£o para Login (Agora chama o Server)
    document.getElementById('login-btn').addEventListener('click', async () => {
        const username = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        const loginMessage = document.getElementById('login-message');

        const data = { username, password };
        const result = await sendPostRequest('/login', data, loginMessage);

        if (result.success) {
            // Se o login foi bem-sucedido pelo servidor, salva a sess√£o local.
            const account = getAccount() || {};
            account.username = username; // Salva o username para exibi√ß√£o
            account.isLoggedIn = true;
            saveAccount(account);

            setTimeout(() => {
                showScreen('home-screen');
                showSubScreen('home-cards-view', 'home');
                loginMessage.textContent = ''; 
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
            }, 1500);
        } else {
            // Permanece na tela de login
        }
    });

    // Fun√ß√£o para Cria√ß√£o de Conta (Agora chama o Server)
    document.getElementById('create-account-btn').addEventListener('click', async () => {
        const username = document.getElementById('new-username').value;
        const email = document.getElementById('new-email').value;
        const password = document.getElementById('new-password').value;
        const fileInput = document.getElementById('new-profile-pic');
        const createMessage = document.getElementById('create-account-message');

        // A simula√ß√£o de upload de imagem √© mantida localmente, mas a autentica√ß√£o vai para o servidor
        const data = { username: email, password, nickname: username }; // Server s√≥ precisa de email/senha. O campo 'new-username' √© opcional no backend mas mantido no frontend.
        
        if (!email || !password) {
            createMessage.textContent = '‚ùå Por favor, preencha Email e Senha.';
            createMessage.style.color = '#ff4444';
            return;
        }

        const result = await sendPostRequest('/signup', data, createMessage);
        
        if (result.success) {
            let profilePicture = DEFAULT_AVATAR;

            // Simula√ß√£o de carregar a imagem, apenas para o frontend (local storage)
            if (fileInput.files.length > 0) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    profilePicture = e.target.result;
                    // Salva a nova sess√£o com a foto, mas o login ainda precisa ser feito.
                    saveAccount({ username: email, isLoggedIn: true, profilePicture }); 
                };
                reader.readAsDataURL(fileInput.files[0]);
            }

            // Vai para a tela de login ap√≥s o cadastro
            setTimeout(() => {
                showSubScreen('login-sub-screen', 'signup');
                document.getElementById('login-email').value = email; // Preenche o email
                createMessage.textContent = ''; 
                document.getElementById('new-username').value = '';
                document.getElementById('new-email').value = '';
                document.getElementById('new-password').value = '';
            }, 1500);
        }
        // Se falhar, a mensagem de erro do servidor √© exibida.
    });

    // Fun√ß√£o para Busca de Jogo (Agora chama o Server)
    if (buscarBtn) {
        buscarBtn.addEventListener('click', async () => {
            const gameId = gameIdInput.value;
            const resultado = resultadoDiv;

            if (!gameId) {
                resultado.textContent = '‚ùå ID do jogo √© obrigat√≥rio.';
                resultado.style.color = '#ff4444';
                return;
            }

            const data = { gameId };
            const result = await sendPostRequest('/buscar', data, resultado);

            // A rota de busca j√° √© tratada dentro de sendPostRequest, o resultado √© a mensagem do servidor.
            if (result.encontrado === false) {
                 resultado.textContent = `‚ùå ${result.msg}`;
                 resultado.style.color = '#ff4444';
            } else if (typeof result === 'object' && result.msg) {
                 // Caso o server retorne JSON de erro que n√£o foi pego acima
                 resultado.textContent = `‚ùå Erro do Servidor: ${result.msg}`;
                 resultado.style.color = '#ff4444';
            } else {
                 // Em caso de sucesso e download iniciado, a mensagem j√° foi definida em sendPostRequest
            }
        });
    }

    // NOVO: Fun√ß√£o para Logout (Permanece local, apenas para remover a sess√£o do browser)
    if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
            if (confirm('Tem certeza que deseja sair da sua conta?')) {
                removeAccount();
                showScreen('signup-screen');
                showSubScreen('signup-cards-view', 'signup');
                // Limpa os campos de edi√ß√£o
                if(editUsernameInput) editUsernameInput.value = '';
                if(editEmailInput) editEmailInput.value = '';
                if(editPasswordInput) editPasswordInput.value = '';
                if (personalizeMessage) {
                    personalizeMessage.textContent = 'Voc√™ saiu da conta com sucesso.';
                    personalizeMessage.style.color = '#00ff80';
                    setTimeout(() => { personalizeMessage.textContent = ''; }, 3000);
                }
            }
        });
    }
    
    // NOVO: Fun√ß√£o para Deletar Conta (Simula√ß√£o, pois a exclus√£o real deve ser no servidor)
    if (deleteAccountBtn) {
        deleteAccountBtn.addEventListener('click', () => {
            const confirmation = prompt("ATEN√á√ÉO: Digite 'DELETAR MINHA CONTA' para confirmar a exclus√£o permanente de todos os seus dados locais. Esta a√ß√£o √© IRREVERS√çVEL!");
            
            if (confirmation === 'DELETAR MINHA CONTA') {
                removeAccount(); // Remove a sess√£o local.
                // Aqui voc√™ enviaria um POST para o servidor: sendPostRequest('/delete-account', { username: getAccount().username }, messageElement)
                showScreen('signup-screen');
                showSubScreen('signup-cards-view', 'signup');
                alert('‚úÖ Sua conta local foi deletada permanentemente com sucesso. (A exclus√£o real no servidor n√£o foi implementada)');
                // Limpa os campos de edi√ß√£o
                if(editUsernameInput) editUsernameInput.value = '';
                if(editEmailInput) editEmailInput.value = '';
                if(editPasswordInput) editPasswordInput.value = '';
            } else if (confirmation !== null) {
                alert('‚ùå Confirma√ß√£o incorreta. A conta n√£o foi deletada.');
            }
        });
    }
    
    // NOVO: Fun√ß√£o para salvar o nome de usu√°rio (Atualiza apenas o display local)
    if (saveUsernameBtn) {
        saveUsernameBtn.addEventListener('click', () => {
            const account = getAccount();
            const newUsername = editUsernameInput.value.trim();
            
            if (!account) {
                personalizeMessage.textContent = '‚ùå Por favor, fa√ßa login primeiro.';
                personalizeMessage.style.color = '#ff4444';
                return;
            }
            if (!newUsername) {
                personalizeMessage.textContent = '‚ùå O campo de nome de usu√°rio n√£o pode estar vazio.';
                personalizeMessage.style.color = '#ff4444';
                return;
            }
            
            // Aqui voc√™ enviaria um POST para o servidor para alterar o nickname real:
            // sendPostRequest('/update-username', { newUsername }, personalizeMessage)

            // Atualiza apenas o local storage para exibi√ß√£o no frontend
            account.username = newUsername; 
            saveAccount(account);
            personalizeMessage.textContent = '‚úÖ Nome de usu√°rio atualizado localmente!';
            personalizeMessage.style.color = '#00ff80';
            editUsernameInput.value = ''; // Limpa o campo
            
            // Atualiza o placeholder
            editUsernameInput.placeholder = `Nome atual: ${newUsername}`;

            setTimeout(() => { personalizeMessage.textContent = ''; }, 3000);
        });
    }
    
    // NOVO: Fun√ß√£o para salvar Email e Senha (Apenas simula√ß√£o)
    if (saveAccountBtn) {
        saveAccountBtn.addEventListener('click', () => {
            const account = getAccount();
            const newEmail = editEmailInput.value.trim();
            const newPassword = editPasswordInput.value.trim();

            if (!account) {
                personalizeMessage.textContent = '‚ùå Por favor, fa√ßa login primeiro.';
                personalizeMessage.style.color = '#ff4444';
                return;
            }
            
            if (!newEmail && !newPassword) {
                 personalizeMessage.textContent = '‚ö†Ô∏è Nenhum campo de email ou senha foi preenchido para salvar.';
                personalizeMessage.style.color = '#ffaa00';
                return;
            }

            // O c√≥digo real deve chamar o servidor para estas altera√ß√µes,
            // que usaria o 'bcrypt' para re-hashear a senha e atualizar o JSON.
            // Ex: sendPostRequest('/update-account', { newEmail, newPassword }, personalizeMessage);
            
            personalizeMessage.textContent = '‚úÖ Altera√ß√µes de Email/Senha enviadas para simula√ß√£o de atualiza√ß√£o!';
            personalizeMessage.style.color = '#00ff80';
            
            // Atualiza o placeholder do email localmente (se houver novo email)
            if (newEmail) {
                 editEmailInput.placeholder = `Email atual: ${newEmail}`;
                 editEmailInput.value = '';
            }
            if (newPassword) {
                editPasswordInput.value = '';
            }
            
            setTimeout(() => { personalizeMessage.textContent = ''; }, 3000);
        });
    }

    // ----------------------------------------------------
    // FUN√á√ïES DE VISIBILIDADE E NAVEGA√á√ÉO (Mantidas)
    // ----------------------------------------------------

    /**
     * Controla a visibilidade da barra lateral e do widget de perfil.
     * @param {boolean} loggedIn Se o usu√°rio est√° logado.
     */
    function toggleSiteVisibility(loggedIn) {
        if (loggedIn) {
            // MOSTRA O CONTE√öDO (LOGADO)
            userProfileWidget.classList.remove('logged-out');
            mainLayout.classList.remove('logged-out'); 
            if (mainTitle) mainTitle.style.display = 'block';
            
            // Esconde o Sign-Up quando logado
            if (sidebarSignupLink) sidebarSignupLink.style.display = 'none';

        } else {
            // ESCONDE O CONTE√öDO (DESLOGADO)
            userProfileWidget.classList.add('logged-out');
            mainLayout.classList.add('logged-out'); 
            if (mainTitle) mainTitle.style.display = 'none';
            
            // Mostra o Sign-Up quando deslogado
            if (sidebarSignupLink) sidebarSignupLink.style.display = 'list-item';

            // Certifica-se de que a tela de login/cadastro √© a √∫nica vis√≠vel
            showScreen('signup-screen');
            showSubScreen('signup-cards-view', 'signup');
        }
    }

    function updateProfileDisplay() {
        const account = getAccount();
        const isLoggedIn = !!account && account.isLoggedIn;
        
        const username = isLoggedIn ? account.username : 'Visitante'; 
        const profilePic = isLoggedIn ? account.profilePicture : DEFAULT_AVATAR;

        // 1. Atualiza o Widget Flutuante
        if (widgetUsername) widgetUsername.innerText = username;
        if (widgetProfilePic) widgetProfilePic.src = profilePic;

        // 2. Atualiza a Pr√©via em Configura√ß√µes
        const profilePicElement = document.getElementById('profile-pic-preview');
        if (profilePicElement) {
            profilePicElement.src = profilePic;
        }
        
        // Chama o controle de visibilidade
        toggleSiteVisibility(isLoggedIn);
    }

    function showScreen(targetId) {
        // Ignora a navega√ß√£o se estiver em modo logged-out e o target n√£o for signup ou terms/about
        const isLoggedIn = !!getAccount() && getAccount().isLoggedIn;
        if (!isLoggedIn && targetId !== 'signup-screen' && targetId !== 'terms-screen' && targetId !== 'about-screen') {
            showScreen('signup-screen');
            return;
        }
        
        contentScreens.forEach(screen => {
            screen.classList.remove('active');
        });
        document.getElementById(targetId).classList.add('active');
        
        // Atualiza o link ativo da sidebar
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.dataset.target === targetId) {
                link.classList.add('active');
            }
        });
        
        // Controla o display do H1 (mainTitle)
        if (mainTitle) {
            mainTitle.style.display = mainLayout.classList.contains('logged-out') ? 'none' : 'block';
        }
    }

    function showSubScreen(targetId, screenType) {
        // Esconde todas as sub-telas e cards views do tipo de tela atual
        let targetSubScreens;
        let targetCardView;
        if (screenType === 'home') {
            targetSubScreens = homeSubScreens;
            targetCardView = homeCardsView;
        } else if (screenType === 'support') {
            targetSubScreens = supportSubScreens;
            targetCardView = supportCardsView;
        } else if (screenType === 'signup') {
            targetSubScreens = signupSubScreens;
            targetCardView = signupCardsView;
        }

        targetSubScreens.forEach(sub => {
            sub.classList.remove('active');
        });
        if (targetCardView) targetCardView.classList.remove('active');
        
        // Mostra o target
        if (targetId) {
            document.getElementById(targetId).classList.add('active');
        } else {
            // Fallback para mostrar a view de cards, se o target for nulo/inv√°lido
             if (targetCardView) targetCardView.classList.add('active');
        }
        
        // Limpa a mensagem de feedback e carrega os dados de edi√ß√£o se for a tela de config
        if (targetId === 'config-sub-screen') {
            const account = getAccount();
            const isLoggedIn = !!account && account.isLoggedIn;
            
            if(isLoggedIn) {
                if(editUsernameInput) editUsernameInput.placeholder = `Nome atual: ${account.username}`;
                // O email n√£o est√° salvo no local storage, apenas o username (simulando token/session)
                if(editEmailInput) editEmailInput.placeholder = `Email (n√£o salvo localmente)`; 
            } else {
                 if(editUsernameInput) editUsernameInput.placeholder = 'Nome de Usu√°rio';
                 if(editEmailInput) editEmailInput.placeholder = 'Email';
            }
            if(editPasswordInput) editPasswordInput.placeholder = 'Nova Senha';
            if(personalizeMessage) personalizeMessage.textContent = ''; 
        }
    }

    // ----------------------------------------------------
    // EVENT LISTENERS (Navega√ß√£o/UI)
    // ----------------------------------------------------

    // Navega√ß√£o principal
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const target = link.dataset.target;
            
            // A fun√ß√£o showScreen j√° lida com a restri√ß√£o de navega√ß√£o quando deslogado
            showScreen(target);
            
            // Certifica-se de que a visualiza√ß√£o de cards da tela √© exibida por padr√£o
            if (target === 'home-screen') showSubScreen('home-cards-view', 'home');
            if (target === 'support-screen') showSubScreen('support-cards-view', 'support');
            // O Sign-up sempre vai para o view de cards
            if (target === 'signup-screen') showSubScreen('signup-cards-view', 'signup'); 
        });
    });

    // Navega√ß√£o via Cards
    featureCards.forEach(card => {
        card.addEventListener('click', () => {
            const targetSub = card.dataset.targetSub;
            const screenElement = card.closest('.content-screen');
            if (!screenElement) return;

            const screenType = screenElement.id.split('-')[0]; // home, support, signup
            showSubScreen(targetSub, screenType);
        });
    });

    // Bot√µes Voltar
    backButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetSub = button.dataset.targetSub;
            const screenType = button.dataset.screenType;
            showSubScreen(targetSub, screenType);
        });
    });

    // Accordion FAQ
    document.querySelectorAll('.faq-question').forEach(question => {
        question.addEventListener('click', () => {
            const answer = question.nextElementSibling;
            const isOpen = answer.classList.contains('open');

            // Fecha todas as outras respostas do mesmo container (opcional, mas bom UX)
            document.querySelectorAll('.faq-answer.open').forEach(openAnswer => {
                if (openAnswer !== answer) {
                    openAnswer.classList.remove('open');
                }
            });
            
            // Alterna a resposta clicada
            if (isOpen) {
                answer.classList.remove('open');
            } else {
                answer.classList.add('open');
            }
        });
    });
    
    // Fun√ß√µes de Tema (Mantidas para funcionar)
    function toggleTheme() {
        if (themeSwitch.checked) {
            body.classList.remove('light-theme');
            localStorage.setItem(THEME_STORAGE_KEY, 'dark');
        } else {
            body.classList.add('light-theme');
            localStorage.setItem(THEME_STORAGE_KEY, 'light');
        }
    }

    function loadTheme() {
        const savedTheme = localStorage.getItem(THEME_STORAGE_KEY) || 'dark';
        if (savedTheme === 'light') {
            body.classList.add('light-theme');
            if (themeSwitch) themeSwitch.checked = false;
        } else {
            body.classList.remove('light-theme');
            if (themeSwitch) themeSwitch.checked = true;
        }
    }

    if(themeSwitch) {
        themeSwitch.addEventListener('change', toggleTheme);
    }
    
    // Simula√ß√£o de Exporta√ß√£o de Dados (JSON)
    document.getElementById('export-data-btn').addEventListener('click', () => {
        const accountData = getAccount();
        const isLoggedIn = !!accountData && accountData.isLoggedIn;
        
        if (!isLoggedIn) {
            alert('Nenhuma conta logada para exportar dados.');
            return;
        }
        
        // Exportamos apenas os dados da sess√£o local, pois os dados reais (senha) est√£o no servidor
        const dataToExport = {
            username_display: accountData.username,
            // A senha real n√£o deve estar no local storage!
            // password: 'A senha real n√£o √© salva no seu navegador (por seguran√ßa)', 
            // email: 'O email deve ser buscado no servidor', 
            hasProfilePicture: accountData.profilePicture !== DEFAULT_AVATAR,
            exportDate: new Date().toISOString(),
            status: 'Estes s√£o apenas os dados de sess√£o locais.'
        };
        const jsonString = JSON.stringify(dataToExport, null, 2);
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `manifest_sample_data_${dataToExport.username_display}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        alert('‚úÖ Exporta√ß√£o conclu√≠da! Verifique sua pasta de downloads. (Aten√ß√£o: A senha real n√£o √© exportada por quest√µes de seguran√ßa)');
    });

    // C√≥digo da Lista de IDs (Simula√ß√£o)
    function loadIdList() {
        const idListContent = document.getElementById('id-list-content');
        idListContent.innerHTML = `
            <div class="list-item"><strong>730</strong> - Counter-Strike 2</div>
            <div class="list-item"><strong>570</strong> - Dota 2</div>
            <div class="list-item"><strong>218620</strong> - Payday 2</div>
            <div class="list-item"><strong>105600</strong> - Terraria</div>
            <div class="list-item"><strong>252490</strong> - Rust</div>
            <div class="list-item"><strong>440</strong> - Team Fortress 2</div>
            <div class="list-item"><strong>8930</strong> - Sid Meier's Civilization V</div>
            <div class="list-item"><strong>431960</strong> - Wallpaper Engine</div>
            <p style="margin-top: 20px; color: #888;">* Lista apenas para demonstra√ß√£o. O sistema real usa a SteamDB.</p>
        `;
    }

    // Inicializa o listener da lista de IDs
    document.querySelector('.feature-card[data-target-sub="list-sub-screen"]').addEventListener('click', loadIdList, { once: true });


    // ----------------------------------------------------
    // INICIALIZA√á√ÉO
    // ----------------------------------------------------
    loadTheme();
    updateProfileDisplay(); // Inicia a p√°gina checando o login e controlando a visibilidade

    const currentAccount = getAccount();
    const isLoggedIn = !!currentAccount && currentAccount.isLoggedIn;
    
    if (!isLoggedIn) {
        // Se n√£o estiver logado, garante que a tela de Sign-Up esteja ativa
        showScreen('signup-screen'); 
        showSubScreen('signup-cards-view', 'signup');
    } else {
        // Se estiver logado, vai para a Home
        showScreen('home-screen'); 
        showSubScreen('home-cards-view', 'home');
    }
</script>

</body>
</html>